{"version":3,"sources":["webpack:///./src/views/Search.vue?cce6","webpack:///src/views/Search.vue","webpack:///./src/views/Search.vue?0d6a","webpack:///./src/views/Search.vue","webpack:///./src/views/Search.vue?6048"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","staticStyle","attrs","rankParam","on","handleSubmit","nativeOn","$event","preventDefault","model","value","callback","$$v","$set","expression","param","_v","ref","_l","item","index","key","openImg","image_urls","large","slice","indexOf","square_medium","slot","id","_s","title","directives","name","rawName","isRun","isResultUndifined","staticRenderFns","data","isComplete","page","tempUrlArr","scrollInterval","created","activated","setInterval","document","addEventListener","scrollevent","deactivated","clearInterval","removeEventListener","computed","filteredTags","$store","state","methods","getPics","window","open","imgUrl","checkTags","includes","tags","i","scr","documentElement","scrollTop","body","clientHeight","scrHeight","component"],"mappings":"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","file":"static/js/chunk-073b81ee.414cf239.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"search\"},[_c('a-form-model',{staticStyle:{\"padding\":\"10px 0\"},attrs:{\"layout\":\"inline\",\"model\":_vm.rankParam},on:{\"submit\":_vm.handleSubmit},nativeOn:{\"submit\":function($event){$event.preventDefault();}}},[_c('a-form-model-item',[_c('a-input',{staticStyle:{\"width\":\"500px\",\"height\":\"50px\",\"font-size\":\"20px\"},attrs:{\"placeholder\":\"参数\"},model:{value:(_vm.rankParam.param),callback:function ($$v) {_vm.$set(_vm.rankParam, \"param\", $$v)},expression:\"rankParam.param\"}})],1),_c('a-form-model-item',[_c('a-button',{staticStyle:{\"width\":\"80px\",\"height\":\"50px\",\"font-size\":\"20px\"},attrs:{\"type\":\"primary\",\"html-type\":\"submit\",\"disabled\":_vm.rankParam.param === ''}},[_vm._v(\"搜索\")])],1)],1),_c('div',{staticClass:\"search-main\"},[_c('a-row',{ref:\"picsRow\"},_vm._l((_vm.tempUrlArr),function(item,index){return _c('a-col',{key:'card' + index,attrs:{\"span\":4}},[_c('a-card',{staticStyle:{\"width\":\"90%\",\"margin-bottom\":\"30px\"},attrs:{\"hoverable\":\"\",\"bodyStyle\":{ 'white-space': 'nowrap' }},on:{\"click\":function($event){_vm.openImg(\n              'https://pximg.pixiv-viewer.workers.dev' +\n                item.image_urls.large.slice(\n                  item.image_urls.large.indexOf('/c/')\n                )\n            )}}},[_c('img',{attrs:{\"slot\":\"cover\",\"src\":'https://pximg.pixiv-viewer.workers.dev' +\n              item.image_urls.square_medium.slice(\n                item.image_urls.square_medium.indexOf('/c/')\n              )},slot:\"cover\"}),_c('a-card-meta',{attrs:{\"title\":item.id}},[_c('template',{slot:\"description\"},[_vm._v(_vm._s(item.title))])],2)],1)],1)}),1),_c('div',{staticClass:\"search-tips\"},[_c('span',{directives:[{name:\"show\",rawName:\"v-show\",value:(!_vm.rankParam.isRun && !_vm.isResultUndifined),expression:\"!rankParam.isRun && !isResultUndifined\"}]},[_vm._v(\"正在加载0v0~\")]),_c('span',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.isResultUndifined),expression:\"isResultUndifined\"}]},[_vm._v(\"再怎么搜也没有了辣>_<~\")])])],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"search\">\n    <a-form-model\n      layout=\"inline\"\n      :model=\"rankParam\"\n      @submit=\"handleSubmit\"\n      @submit.native.prevent\n      style=\"padding: 10px 0\"\n    >\n      <a-form-model-item>\n        <a-input\n          v-model=\"rankParam.param\"\n          placeholder=\"参数\"\n          style=\"width: 500px; height: 50px; font-size: 20px\"\n        ></a-input>\n      </a-form-model-item>\n      <a-form-model-item>\n        <a-button\n          type=\"primary\"\n          html-type=\"submit\"\n          :disabled=\"rankParam.param === ''\"\n          style=\"width: 80px; height: 50px; font-size: 20px\"\n          >搜索</a-button\n        >\n      </a-form-model-item>\n    </a-form-model>\n    <div class=\"search-main\">\n      <a-row ref=\"picsRow\">\n        <a-col\n          :span=\"4\"\n          v-for=\"(item, index) in tempUrlArr\"\n          :key=\"'card' + index\"\n        >\n          <a-card\n            hoverable\n            style=\"width: 90%; margin-bottom: 30px\"\n            @click=\"\n              openImg(\n                'https://pximg.pixiv-viewer.workers.dev' +\n                  item.image_urls.large.slice(\n                    item.image_urls.large.indexOf('/c/')\n                  )\n              )\n            \"\n            :bodyStyle=\"{ 'white-space': 'nowrap' }\"\n          >\n            <img\n              slot=\"cover\"\n              :src=\"\n                'https://pximg.pixiv-viewer.workers.dev' +\n                item.image_urls.square_medium.slice(\n                  item.image_urls.square_medium.indexOf('/c/')\n                )\n              \"\n            />\n            <a-card-meta :title=\"item.id\">\n              <template slot=\"description\">{{ item.title }}</template>\n            </a-card-meta>\n          </a-card>\n        </a-col>\n      </a-row>\n      <div class=\"search-tips\">\n        <!-- 正在搜索时 -->\n        <span v-show=\"!rankParam.isRun && !isResultUndifined\"\n          >正在加载0v0~</span\n        >\n        <!-- 无搜索结果时 -->\n        <span v-show=\"isResultUndifined\">再怎么搜也没有了辣&gt;_&lt;~</span>\n      </div>\n    </div>\n  </div>\n</template>\n\n<style lang=\"less\">\n</style>\n\n<script>\nimport Axios from \"axios\";\n\nexport default {\n  name: \"Search\",\n  data() {\n    return {\n      // 输入框内容\n      rankParam: {\n        param: \"\", // 搜索框内容\n        isComplete: false, // 搜索结果是否全部展示\n        isRun: true, // 当前是否可搜索\n      },\n      page: 1, // 下一页的页码\n      tempUrlArr: [], // 小图url数组\n      isResultUndifined: false, // 查询返回结果是否为空\n      scrollInterval: {}, // 滚轮循环的存储\n    };\n  },\n  created() {\n    this.rankParam.param = \"原神\";\n    this.handleSubmit();\n  },\n  activated() {\n    // 切入时绑定滚轮事件、设置定时器监听是否到底部\n    this.scrollInterval = setInterval(() => {\n      this.scrollevent();\n    }, 5000);\n    document.addEventListener(\"scroll\", this.scrollevent);\n  },\n  deactivated() {\n    // 切出时解绑滚轮事件、取消定时器\n    clearInterval(this.scrollInterval);\n    document.removeEventListener(\"scroll\", this.scrollevent);\n  },\n  computed: {\n    // vuex中获取要过滤的tags数组\n    filteredTags() {\n      return this.$store.state.filteredTags;\n    },\n  },\n  methods: {\n    handleSubmit() {\n      this.tempUrlArr = [];\n      this.page = 1;\n      this.rankParam.isComplete = false;\n      this.rankParam.isRun = true;\n      this.isResultUndifined = false;\n      this.getPics();\n    },\n    // 向后台发送请求并将结果处理后存入tempUrlArr\n    getPics() {\n      if (this.rankParam.isComplete || !this.rankParam.isRun) {\n        return;\n      }\n      // 去后台搜索前对搜索功能进行封闭，以免重复触发搜索出bug\n      this.rankParam.isRun = false;\n      let tempUrl =\n        \"https://api.imjad.cn/pixiv/v2/?type=search&word=\" +\n        this.rankParam.param +\n        \"&page=\" +\n        this.page;\n      let _t = this;\n      Axios.get(tempUrl)\n        .then((res) => {\n          // 当成功返回未知的错误信息，将page加1，打开搜索功能再次尝试\n          if (res.data.error) {\n            _t.page++;\n            _t.rankParam.isRun = true;\n            _t.getPics();\n            return;\n          }\n          // 当返回结果为空时给出页面提示，并打开搜索已完成开关，避免重复发送搜索请求\n          if (res.data.illusts.length == 0) {\n            _t.isResultUndifined = true;\n            _t.rankParam.isComplete = true;\n          } else {\n            _t.isResultUndifined = false;\n          }\n\n          // 根据tempUrlArr循环过滤作品tags\n          for (let i = 0; i < res.data.illusts.length; i++) {\n            if (this.checkTags(res.data.illusts[i].tags)) {\n              continue;\n            }\n            // 向临时数组中增加过滤后的作品\n            _t.tempUrlArr.push(res.data.illusts[i]);\n          }\n          // 请求成功后增加当前页码\n          _t.page++;\n        })\n        .catch((err) => {\n          console.log(err);\n        })\n        .finally(() => {\n          // 请求结束1秒后打开搜索功能\n          setTimeout(() => {\n            _t.rankParam.isRun = true;\n          }, 1000);\n        });\n    },\n    // 新窗口打开图片\n    openImg(imgUrl) {\n      window.open(imgUrl, \"_blank\");\n    },\n    // 检查tags对象数组中是否包含需要过滤的tag，若是返回true\n    checkTags(tags) {\n      for (let i = 0; i < tags.length; i++) {\n        if (this.filteredTags.includes(tags[i].name)) {\n          return true;\n        }\n      }\n      return false;\n    },\n    // 滚轮滚动检测是否到底\n    scrollevent() {\n      var scr = document.documentElement.scrollTop || document.body.scrollTop; // 向上滚动的那一部分高度\n      var clientHeight = document.documentElement.clientHeight; // 屏幕高度也就是当前设备静态下你所看到的视觉高度\n      var scrHeight =\n        document.documentElement.scrollHeight || document.body.scrollHeight; // 整个网页的实际高度，兼容Pc端\n      if (scr + clientHeight > scrHeight - 150) {\n        this.getPics();\n      }\n    },\n  },\n};\n</script>\n<style lang=\"less\">\n.search {\n  .search-main {\n    background-color: #fff;\n    padding: 24px;\n    min-height: 280px;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n\n    .search-tips {\n      font-size: large;\n    }\n  }\n\n  .ant-card {\n    margin: 0 auto;\n  }\n\n  // 图片卡片描述超出范围隐藏\n  .textEllipsis {\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n}\n</style>","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Search.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Search.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Search.vue?vue&type=template&id=c23caa76&\"\nimport script from \"./Search.vue?vue&type=script&lang=js&\"\nexport * from \"./Search.vue?vue&type=script&lang=js&\"\nimport style1 from \"./Search.vue?vue&type=style&index=1&lang=less&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../node_modules/_less-loader@6.2.0@less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Search.vue?vue&type=style&index=1&lang=less&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../node_modules/_less-loader@6.2.0@less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Search.vue?vue&type=style&index=1&lang=less&\""],"sourceRoot":""}